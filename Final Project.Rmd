---
title: "Case Study Bellabeat: Mendapatkan Strategi Pemasaran Bellabeat Melalui Trend Kustomer non-Bellabeat Menggunakan Smart Devices"
author: "Rifal Faturrohman"
date: "2022-11-16"
output:

  html_document: default
---

# Prepare

### Import library R yang digunakan
```{r}
library(here) 
library(tidyverse)
library(skimr)
library(janitor) 
library(ggplot2)
library(ggpubr)
library(lubridate)
```

### Mengimpor dataset yang diperlukan
```{r}
daily_activity <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/dailyActivity_merged.csv")
daily_calories <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/dailyCalories_merged.csv")
daily_intensities <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/dailyIntensities_merged.csv")
daily_steps <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/dailySteps_merged.csv")
daily_sleep <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/sleepDay_merged.csv")
heart_rate <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/heartrate_seconds_merged.csv")
weight_info <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/weightLogInfo_merged.csv")
hourly_steps <- read_csv("C:/Users/User/Documents/FitaBase Data 4.12.16 - 5.12.16/hourlySteps_merged.csv")
```

### Memeriksa setiap dataframe yang digunakan
```{r}
str(daily_activity)
```

Setelah dikakukan pemeriksaan data, didapatkan dataset daily_calories, daily_intensities dan daily_steps merupkan subset dari daily_activity, maka hanya digunakan dataset daily_activity menjadi satu dataframe.

### Memverifikasi jumlah user
```{r}
n_distinct(daily_activity$Id)
n_distinct(daily_sleep$Id)
n_distinct(heart_rate$Id)
n_distinct(weight_info$Id)
n_distinct(hourly_steps$Id)
```

setelah dilakukannya verifikasi jumlah user, didapatkan perbedaan jumlah user pada dataset. Perbedaan yang signifikan terdapat pada dataset heart_rate dan weight_info yang memilika jumlah sample yang kecil, maka tidak akan digunakan dalam studi kasus ini. Pada dataset sleep_day memiliki jumlah sample yang tidak sama dengan daily_activity, namun tetap digunakan sabagai referensi. Dataset hourly_steps digunakan untuk menganalisis penggunaan device setiap jam nya setiap hari dalam seminggu.


# Process
## Cleaning, manipulating and formatting data

### Mengecek duplikat dan missing value yang ada pada data
```{r}

sum(duplicated(daily_activity))
sum(duplicated(daily_sleep))
sum(duplicated(hourly_steps))
sum(duplicated(heart_rate))
sum(duplicated(weight_info))
```
```{r}
sum(is.na(daily_activity))
sum(is.na(daily_sleep))
sum(is.na(hourly_steps))
sum(is.na(heart_rate))
sum(is.na(weight_info))
```

Terdapat missing value pada data weight_info, namun tidak dilakukan penghapusan missing value, karena metrik yang akan diukur hanya berfokus pada jumlah user.

### Menghapus duplikat 
```{r}
daily_sleep <- daily_sleep %>% 
  distinct()

sum(duplicated(daily_sleep))
```
Sekarang duplikat yang ada di sleep_day telah dihapus.

### Membersihkan dam mengganti nama kolom
FUngsi clean_names digunakan untuk memberikan keunikan dan konsistensi pada penamaan kolom, dan juga memformat keseluruhan kolom menjadi lower case.
```{r}
daily_activity <- clean_names(daily_activity)
daily_sleep <- clean_names(daily_sleep)
hourly_steps <- clean_names(hourly_steps)
heart_rate <- clean_names(heart_rate)
weight_info <- clean_names(weight_info)

colnames(daily_activity)
colnames(daily_sleep)
colnames(hourly_steps)
colnames(heart_rate)
colnames(weight_info)
```

### Mengkonversi format tanggal dan waktu
untuk menjaga konsistensi dari date-time, maka diperlukan pembersihan pada date-time dari kedua dataframe sebelum di merging. 
```{r}
daily_activity <- daily_activity %>% 
  rename(date = activity_date) %>% 
  mutate(date = as_date(date, format="%m/%d/%Y"))

daily_sleep <- daily_sleep %>% 
  rename(date = sleep_day) %>% 
  mutate(date = as_date(date, format="%m/%d/%Y"))

hourly_steps <- hourly_steps %>% 
  rename(date_time = activity_hour) %>% 
  mutate(date_time = as.POSIXct(date_time, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone()))

heart_rate <- heart_rate %>% 
  rename(date_time = time) %>% 
  mutate(date_time = as.POSIXct(date_time, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone()))

weight_info <- weight_info %>% 
  rename(date_time = date) %>% 
  mutate(date_time = as.POSIXct(date_time, format="%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone()))


head(daily_activity)
head(daily_sleep)
head(hourly_steps)
head(heart_rate)
head(weight_info)
```

### Menggabungkan data 
Menggabungkan data daily_activity dan daily_sleep untuk melihat berbagai macam korelasi diantara keduanya, yang berdasarkan id dan date.
```{r}
all_activity_merged <- merge(daily_activity, daily_sleep, by=c("id","date"))
head(all_activity_merged)
```


# Analyze and Share 

## Mengeksplorasi dan data summary setiap dataset
```{r}

#explore daily steps, calories and sleep 
all_activity_merged %>% 
  select(total_steps, calories, total_minutes_asleep) %>% 
  summary()

#explore num of active distance per category
all_activity_merged %>% 
  select(very_active_distance, moderately_active_distance, light_active_distance, sedentary_active_distance) %>% 
  summary()

#explore num of active minutes per category
all_activity_merged %>% 
  select(very_active_minutes, fairly_active_minutes, lightly_active_minutes, sedentary_minutes) %>% 
  summary()

```

## Mengelompokan pengguna menjadi 4 activity levels
Mengkalkulasi nilai rata-rata daily steps dari pengguna dana diklasifikasikan menjadi 4 level aktivitas.
```{r}
#calculate the daily steps average by user and classify by 4 level activity
user_type <- all_activity_merged %>% 
  group_by(id) %>% 
  summarise(avg_daily_steps = mean(total_steps),
            avg_daily_calories = mean(calories),
            avg_daily_sleep = mean(total_minutes_asleep)) %>% 
  mutate(user_level = case_when(avg_daily_steps < 5000 ~ "Sedentary",
                                avg_daily_steps >= 5000 & avg_daily_steps < 7499 ~ "Lightly Active",
                                avg_daily_steps >= 7500 & avg_daily_steps < 9999 ~ "Fairly Active",
                                avg_daily_steps >= 10000 ~ "Highly Active"))

user_type$user_level <- ordered(
  user_type$user_level,
  levels = c("Highly Active", "Fairly Active", 
             "Lightly Active", "Sedentary"))
user_type <- arrange(user_type, user_level)
head(user_type)
```

Membuat dataframe dengan persentase setiap tipe pengguna
```{r}
user_type_percent <- user_type %>% 
  group_by(user_level) %>% 
  summarise(total = n()) %>% 
  mutate(total_percent = scales::percent (total/sum(total)))
head(user_type_percent)
```

### Memvisualisasikan user types distribution
```{r}
ggplot(data = user_type_percent, aes(x="", y=total_percent, fill=user_level))+
  geom_bar(stat = "identity", width=1)+
  geom_text(aes(label = total_percent),
             color="white",
             position = position_stack(vjust = 0.5),
             show.legend = FALSE)+
  coord_polar(theta = "y")+
  theme_minimal()+
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.border = element_blank(),
    panel.grid=element_blank(),
    axis.ticks = element_blank(),
    axis.text.x = element_blank(),
    plot.title=element_text(hjust =0.5, size=14, face="bold"))+
  scale_fill_manual(values = c("#603e95","#d7255d","#fac22b", "#009da1"))+
  labs(title = "User Type Distribution")
```

## Daily steps selama satu minggu berdasarkan tipe pengguna
```{r}
weekday_steps <- all_activity_merged %>% 
  mutate(weekday = weekdays(date)) %>% 
  left_join(user_type, by="id") %>% 
  group_by(user_level, weekday) %>% 
  summarise(daily_steps = mean(total_steps))

weekday_steps$weekday <- ordered(
  weekday_steps$weekday, 
  levels=c("Monday", "Tuesday", "Wednesday", "Thursday",
           "Friday", "Saturday", "Sunday"))
head(weekday_steps)
```

### Memvisualisasikan rata-rata langkah harian dalam satu minggu
```{r}
ggplot(weekday_steps, aes(x=weekday, y=daily_steps, group=user_level, fill=user_level))+
  geom_bar(stat = 'identity')+
  facet_wrap(vars(user_level))+
  scale_fill_manual(values = c("#603e95","#d7255d","#fac22b", "#009da1"))+
  labs(title = "Average daily steps in days of the week", x="", y="")+
  guides(x = guide_axis(angle = 45))+
  theme(axis.text.x = element_text(size = 14, vjust = 0.3),
        axis.text.y = element_text(size = 14),
        panel.border = element_rect(fill = 'transparent', color = 'black', size = .5),
        panel.background = element_blank(),
        strip.text.x = element_text(size = 16),
        plot.title = element_text(size = 18, hjust = .5),
        legend.position = 'none')
```

## Level aktivitas selama satu hari dalam seminggu
Analisis dilakukan dengan meilihat aktivitas selama 1 hari setiap jam nya. Hal ini dilakukan untuk mendapatkan wawasan mengenai waktu aktif pengguna dalam 1 hari.
```{r}
hourly_steps <- hourly_steps %>% 
  separate(date_time, into = c("date", "time"), sep = " ") %>% 
  mutate(date = ymd(date)) %>% 
  mutate(time = str_sub(time, 1, 5))

hourly_steps_weekday <- hourly_steps %>% 
  mutate(weekday = weekdays(date)) %>% 
  group_by(weekday, time) %>% 
  summarize(avg_steps = mean(step_total), .groups = 'drop')

hourly_steps_weekday$weekday <- ordered(
  hourly_steps_weekday$weekday, 
  levels=c("Monday", "Tuesday", "Wednesday", "Thursday",
           "Friday", "Saturday", "Sunday"))
head(hourly_steps_weekday)
```

### Memvisualisasikan level aktivitas selama satu hari dalam seminggu
```{r}
#A heat map will show active time during the days of the week
ggplot(hourly_steps_weekday, aes(x=time, y=weekday, fill=avg_steps))+
  geom_tile(color="white", lwd=.6, linetype=1)+
  scale_fill_viridis_c()+
  coord_fixed()+
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5, vjust = 1, size = 12, face="bold"),
        panel.background = element_blank(),
        legend.title = element_text(size=8, face="bold"),
        legend.text = element_text(size=8),
        legend.key.size = unit(0.35,'cm'))+
  labs(title = "Active Time During the Days of the Week",
       x=" ", y=" ", fill="Average\nSteps")
```


## Correlation

### Daily steps vs calories burned
```{r}
ggplot(all_activity_merged, aes(x=total_steps, y=calories))+
  geom_jitter(alpha=.5)+
  geom_rug(position = "jitter", size=.08)+
  geom_smooth(size=.6)+
  theme_minimal()+
  stat_cor(method = "pearson", label.x = 200, label.y = 4600)+
  labs(title = "Daily Steps vs. Calories Burned", x = "Daily steps", y = "Calories")
```

### Daily steps vs Minutes asleep
```{r}
ggplot(all_activity_merged, aes(x=total_steps, y=total_minutes_asleep))+
  geom_jitter(alpha=.5)+
  geom_rug(position = "jitter", size=.08)+
  geom_smooth(size=.6)+
  theme_minimal()+
  stat_cor(method = "pearson", label.x = 14000, label.y = 750)+
  labs(title = "Daily Steps vs. Minutes asleep", x = "Daily steps", y = "Minutes asleep")
```


## User's habits in using tracker
```{r}
daily_use <- all_activity_merged %>% 
  group_by(id) %>% 
  summarize(record_days = sum(n())) %>% 
  mutate(usage = case_when(
    record_days >= 1 & record_days <= 10 ~ "Low use",
    record_days >= 11 & record_days <= 20 ~ "Mid use",
    record_days >= 21 & record_days <= 31 ~ "High use",
  ))
head(daily_use)
```

Membuat dataframe dengan nilai persen
```{r}
daily_use_percent <- daily_use %>% 
  group_by(usage) %>% 
  summarise(user_count = n()) %>% 
  mutate(total_percent = scales::percent (user_count/sum(user_count)))
head(daily_use_percent)
```

### Memvisualisasikan User's habit distribution
```{r}
ggplot(data = daily_use_percent, aes(x="", y=total_percent, fill=usage))+
  geom_bar(stat = "identity", width=1)+
  geom_text(aes(label = total_percent),
            color="black",
            position = position_stack(vjust = 0.5),
            show.legend = FALSE)+
  coord_polar(theta = "y")+
  theme_minimal()+
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.border = element_blank(),
    panel.grid=element_blank(),
    axis.ticks = element_blank(),
    axis.text.x = element_blank(),
    plot.title=element_text(hjust =0.5, size=14, face="bold"))+
  scale_fill_manual(values = c("#e63946","#ffed66","#00cecb"))+
  labs(title = "User's Habit Distribution")
```

### Jumlah pengguna berdasarkan smart device feature
```{r}
feature_list <- c(
  "Activity Tracker",
  "Sleep Tracker",
  "Heart Rate",
  "Weight Info"
)

number_usage <- c(
  33,
  24,
  14,
  8
)

device_feature <- tibble(feature_list, number_usage) %>% 
  arrange(-number_usage)
```

### Memvisualisasikan jumlah pengguna berdasarkan smart device feature
```{r}
ggplot(device_feature, 
       aes(x = forcats::fct_reorder(feature_list, number_usage), 
           y = number_usage, fill = number_usage)) +
  coord_flip()+
  geom_col() +
  geom_text(aes(label=number_usage),
            hjust=-0.4, size=4, fontface="bold")+
  theme_void()+
  theme(
    axis.text.y = element_text(size = 13, hjust = 1),
    plot.margin = margin(15, 30, 15, 15),
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, vjust = 1))+
  labs(title="Number of User by Smart Device Feature")
```


